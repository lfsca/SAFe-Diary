{% extends 'base.html' %}
{% load static %}

{% block title %}Challenges do SAFe{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/challenges.css' %}">
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block content %}
<div class="">
  <div class="hero-section text-center mb-4">
    <h1>SAFe Challenges</h1>
    <h2 class="fs-4">Most common challenges faced while implementing the SAFe methodology</h2>
  </div>

  <!-- Select de challenges -->
  <div class="d-flex justify-content-center mb-5">
    <div class="card shadow-sm border-0 p-4" style="width: 50%; background-color: #f8f9fa;">
      <h5 class="mb-3 text-center" style="color: #134e5e;">Select a Challenge</h5>
      <select id="challenge-select" class="form-select custom-select text-center fs-5">
        <option value="" selected disabled>---</option>
        {% for challenge in challenges %}
          <option value="{{ challenge.id }}">{{ challenge.get_title_display }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="row">
    <!-- Coluna esquerda: descrição + soluções -->
    <div class="col-md-6">
      {% for challenge in challenges %}
        <div id="desc-{{ challenge.id }}" class="card-descricao hide card shadow-sm p-4 mb-4" style="max-width: 85%; margin-left: auto; margin-right: auto;">
          <h5 style="color: #134e5e;">{{ challenge.get_title_display }}</h5>
          <p>{{ challenge.description }}</p>

          <div class="card mt-3">
            <div class="card-body">
              <h6 class="card-title" style="color: #134e5e;">Soluções propostas</h6>
              {% if solutions_by_challenge %}
                {% for sol in solutions_by_challenge %}
                  <div class="mb-2">
                    <p class="mb-0"><strong>{{ sol.author.username }}</strong>:</p>
                    <p>{{ sol.description }}</p>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-muted fst-italic">Nenhuma solução registrada.</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Coluna direita: ocorrências -->
    <div class="col-md-6">
      {% for challenge in challenges %}
        <div id="group-{{ challenge.id }}" class="hide card shadow-sm p-4 mb-4" style="max-width: 85%; margin-left: auto; margin-right: auto;">
          <h6 class="card-title" style="color: #134e5e;">Ocorrências</h6>
          {% if ocurrences_by_challenge %}
            {% for oc in ocurrences_by_challenge %}
              <div class="card mb-3 p-3 border-start border-4 border-success">
                <h6><strong>Usuário:</strong> {{ oc.user.username }}</h6>
                <p><strong>Data:</strong> {{ oc.occurred_at|date:"d/m/Y" }}</p>
                {% if oc.notes %}
                  <p>{{ oc.notes }}</p>
                {% else %}
                  <p class="text-muted fst-italic">Sem descrição.</p>
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted fst-italic">Nenhuma ocorrência registrada para este challenge.</p>
          {% endif %}
        </div>
      {% endfor %}
      <div class="text-center mt-4">
        <a id="btn-registrar" href="#" class="btn btn-success disabled">
          + Registrar Ocorrência
        </a>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'js/challenges.js' %}"></script>
{% endblock %}
